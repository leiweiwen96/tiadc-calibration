# 仿真参数对比：实采数据 vs 当前仿真

## 问题：为什么Post-EQ/Post-NL没有明显作用？

### 根本原因：仿真数据太"干净"

## 参数对比表

| 失配类型 | 修改前仿真 | 修改后仿真 | 实采ADC | 说明 |
|---------|-----------|-----------|---------|------|
| **线性失配** |
| 延迟失配 | 0.25采样周期 | 0.25采样周期 | 0.1-0.5 | ✅ 合理 |
| 增益失配 | 2% | 2% | 1-5% | ✅ 合理 |
| 带宽差异 | 200MHz | 200MHz | 100-500MHz | ✅ 合理 |
| **非线性失配** |
| HD2差异 | **2倍** (0.1% vs 0.2%) | **5倍** (0.1% vs 0.5%) | **3-10倍** | ⭐关键 |
| HD3差异 | **2倍** | **6倍** (0.05% vs 0.3%) | **3-8倍** | ⭐关键 |
| 高阶非线性 | ❌ 无 | ❌ 无 | ✅ 有HD4/HD5 | 实采更复杂 |
| 交调失真 | ❌ 无 | ❌ 无 | ✅ 有IMD3/IMD5 | 实采更复杂 |
| **ADC特性** |
| INL/DNL | ❌ 理想量化 | ❌ 理想量化 | ✅ 0.5-2 LSB | 实采有非理想 |
| 孔径抖动 | 简单高斯 | 简单高斯 | 复杂时变 | 实采更复杂 |
| 建立时间 | ❌ 无 | ❌ 无 | ✅ 有限建立 | 实采有影响 |
| **其他因素** |
| 温度漂移 | ❌ 无 | ❌ 无 | ✅ 有 | 实采时变 |
| 电源噪声 | ❌ 无 | ❌ 无 | ✅ 有PSRR影响 | 实采有干扰 |
| 信号完整性 | ❌ 理想 | ❌ 理想 | ✅ 反射/串扰 | 实采有损耗 |

## 为什么修改前Post-EQ/Post-NL没用？

### 1. 非线性失配太弱（核心原因）
- **修改前**：HD2只有2倍差异（1e-3 vs 2e-3）
- **结果**：Post-Linear就把性能做到9bit ENOB
- **问题**：残留非线性太小，Post-NL无法改善，alpha自动选为0

### 2. Post-Linear已经很强
Post-Linear包含：
- Stage1: 延迟、增益对齐
- Stage2: 多tap FIR校正频率响应
- **能力**：可以校正所有**线性失配**

只要非线性失配不强，Post-Linear就能达到很高性能。

### 3. 仿真模型太简单
- 频率响应：理想Butterworth（实际是复杂的幅相特性）
- 非线性：只有二次/三次项（实际有记忆效应、交调）
- ADC：理想量化（实际有INL/DNL、建立时间）

## 修改后的预期效果

### 修改前（非线性2倍差异）
```
Pre-Calib:  ENOB=6→2bit, THD=-20dBc
Post-Linear: ENOB=9bit, THD=-65dBc  ← 已经很好
Post-EQ:     ENOB=9bit, THD=-65dBc  ← 完全重合
Post-NL:     ENOB=9bit, THD=-65dBc  ← 完全重合（alpha=0）
```

### 修改后（非线性5-6倍差异）
```
Pre-Calib:  ENOB=5→2bit, THD=-30~-50dBc  ← 更差（非线性更强）
Post-Linear: ENOB=8bit, THD=-55dBc      ← 改善有限（FIR无法校正非线性）
Post-EQ:     ENOB=8.5bit, THD=-62dBc    ← 有明显改善
Post-NL:     ENOB=9bit, THD=-70dBc      ← 进一步改善（alpha≈0.3）
```

## 为什么实采数据上Post-EQ/Post-NL更有用？

实采ADC有更多仿真未包含的非理想因素：

### 1. 更复杂的非线性
- ✅ 高阶谐波（HD4, HD5, ...）
- ✅ 交调失真（IMD3, IMD5, ...）
- ✅ 记忆效应（温度、历史相关）
- ✅ 频率相关的非线性

### 2. ADC非理想特性
- ✅ INL/DNL（积分/差分非线性度）
- ✅ 孔径抖动（时变、相关）
- ✅ 建立时间不足
- ✅ 量化噪声调制

### 3. 系统级影响
- ✅ 温度漂移
- ✅ 电源噪声（PSRR）
- ✅ 信号完整性（反射、串扰、地弹）
- ✅ 时钟抖动（不是简单高斯）

### 4. 更复杂的频率响应
- ✅ 非最小相位特性
- ✅ 群延时非线性
- ✅ 镜像带不对称
- ✅ 带外滚降不理想

## 结论

### 仿真数据的局限性
- ✅ 可以验证算法框架
- ✅ 可以验证线性校正能力
- ⚠️ 难以完全模拟实采的复杂性
- ⚠️ Post-EQ/Post-NL的效果可能被低估

### 实采数据的优势
- ✅ 包含所有真实非理想因素
- ✅ Post-EQ/Post-NL会有更明显作用
- ✅ 更能验证算法的鲁棒性
- ✅ 更贴近实际应用场景

### 建议
1. **仿真阶段**：增强非线性失配（5-10倍），验证Post-NL有效性
2. **实采验证**：Post-EQ/Post-NL应该会比仿真更有用
3. **参数调优**：实采数据上可能需要调整权重、学习率等
4. **性能预期**：实采的Pre-Calib可能更差，但Post-NL改善会更明显

## 快速参考

| 场景 | Post-Linear够不够 | 需要Post-EQ | 需要Post-NL |
|------|-----------------|------------|------------|
| 修改前仿真（HD2差2倍） | ✅ 够用 | ❌ 不需要 | ❌ 不需要 |
| 修改后仿真（HD2差5倍） | ⚠️ 有限 | ✅ 需要 | ✅ 需要 |
| 实采数据 | ⚠️ 不够 | ✅ 强烈需要 | ✅ 强烈需要 |

---
更新时间：2026-01-23
